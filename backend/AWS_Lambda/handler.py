import json
import boto3, botocore
import secrets
bucket = 'BUCKET_NAME'
route = 'routes/'

# List borrowed from https://github.com/aaronbassett/Pass-phrase and https://gist.github.com/atduskgreg/3cf8ef48cb0d29cf151bedad81553a54
adjs = ['uneven', 'yummy', 'juicy', 'young', 'late', 'macho', 'kaput', 'busy', 'puffy', 'hard', 'fat', 'sedate', 'yellow', 'dapper', 'vast', 'cool', 'elated', 'wary', 'level', 'wooden', 'cloudy', 'flashy', 'trite', 'quick', 'round', 'slow', 'brave', 'sloppy', 'odd', 'sordid', 'blue', 'ugly', 'deeply', 'rotten', 'sour', 'abrupt', 'loose', 'torpid', 'strong', 'dry', 'great', 'ultra', 'ahead', 'broken', 'dusty', 'creepy', 'narrow', 'marked', 'bloody', 'chunky', 'oval', 'stingy', 'angry', 'faint', 'rustic', 'few', 'calm', 'tacky', 'greasy', 'minor', 'loving', 'flat', 'clever', 'pretty', 'hurt', 'tested', 'long', 'warm', 'known', 'meek', 'somber', 'cuddly', 'salty', 'crazy', 'joyous', 'high', 'gabby', 'wet', 'sharp', 'tan', 'huge', 'chilly', 'needy', 'flaky', 'hot', 'husky', 'gaping', 'faulty', 'watery', 'lucky', 'burly', 'filthy', 'harsh', 'short', 'light', 'green', 'puny', 'classy', 'tall', 'mute', 'shaky', 'cold', 'sassy', 'crabby', 'curly', 'better', 'nifty', 'orange', 'ritzy', 'wacky', 'good', 'soggy', 'grubby', 'placid', 'half', 'bawdy', 'measly', 'abaft', 'goofy', 'heavy', 'square', 'awful', 'aloof', 'giddy', 'large', 'petite', 'jolly', 'red', 'phobic', 'trashy', 'godly', 'greedy', 'small', 'icky', 'bumpy', 'silent', 'scary', 'shaggy', 'wrong', 'aboard', 'gusty', 'loud', 'exotic', 'vulgar', 'fancy', 'clumsy', 'fast', 'chubby', 'open', 'little', 'fair', 'murky', 'earthy', 'heady', 'oafish', 'tangy', 'gaudy', 'brainy', 'shiny', 'snotty', 'foamy', 'elite', 'wide', 'kind', 'bored', 'boring', 'glossy', 'glib', 'modern', 'swanky', 'gentle', 'brawny', 'curved', 'afraid', 'fierce', 'frail', 'cooing', 'tired', 'mushy', 'proud', 'upset', 'hungry', 'absurd', 'clean', 'wry', 'lying', 'super', 'cute', 'brief', 'bright', 'fuzzy', 'lethal', 'scarce', 'fine', 'giant', 'stormy', 'quaint', 'unable', 'black', 'shrill', 'spiffy', 'misty', 'famous', 'new', 'nasty', 'seemly', 'tawdry', 'shy', 'bad', 'stupid', 'ruddy', 'slimy', 'fluffy', 'nasty ', 'tender', 'woozy', 'teeny', 'moldy', 'uppity', 'sable', 'silly', 'ad hoc', 'wiry', 'lazy', 'zippy', 'pumped', 'weak', 'tacit', 'weary', 'rapid', 'smoggy', 'swift', 'steep', 'quack', 'ill', 'quiet', 'tough', 'sulky', 'elfin', 'sweet', 'hollow', 'lowly', 'acrid', 'aback', 'damp', 'erect', 'Early', 'lovely', 'empty', 'easy', 'jaded', 'homely', 'tense', 'abject', 'solid', 'plain', 'raspy', 'irate', 'melted', 'cagey', 'many', 'wild', 'alike', 'ripe', 'lush', 'zonked', 'dizzy', 'funny', 'madly', 'clammy', 'itchy', 'clear', 'used', 'null', 'rainy', 'evil', 'alert', 'amuck', 'rabid', 'robust', 'overt', 'bitter', 'craven', 'breezy', 'ragged', 'knotty', 'grumpy', 'dark', 'versed', 'sleepy', 'lavish', 'roomy', 'wee', 'drunk', 'royal', 'eager', 'spooky', 'poised', 'real', 'testy', 'big', 'gamy', 'early', 'nappy', 'vague', 'nosy', 'tart', 'soft', 'poor', 'gifted', 'old', 'alive', 'mighty', 'ablaze', 'racial', 'purple', 'broad', 'lean', 'legal', 'witty', 'nutty', 'icy', 'jumpy', 'jazzy', 'utter', 'dead', 'noisy', 'rare', 'ratty', 'muddy', 'tight', 'daffy', 'smelly', 'lively', 'amused', 'lewd', 'mere', 'sad', 'innate', 'sneaky', 'tame', 'lonely', 'low', 'happy', 'spicy', 'taboo', 'upbeat', 'dull', 'plucky', 'groovy', 'absent', 'wise', 'smooth', 'tiny', 'cruel', 'dirty', 'mature', 'faded', 'wicked', 'steady', 'deep', 'sticky', 'jagged', 'tasty', 'zany', 'wet ', 'naive', 'nice', 'brash', 'silky', 'drab', 'aware', 'skinny', 'tricky', 'sore', 'rich', 'stale', 'daily', 'rough', 'fresh', 'hushed', 'rural']
animals = ['Cat', 'Cattle', 'Dog', 'Donkey', 'Goat', 'Horse', 'Pig', 'Rabbit', 'Alpaca', 'list', 'Ant', 'Ape', 'Aphid', 'Asp', 'Baboon', 'Badger', 'Bass', 'Bat', 'Bear', 'list', 'Beaver', 'Bedbug', 'Bee', 'Beetle', 'Bird', 'list', 'Bison', 'Boa', 'Boar', 'Bobcat', 'Bonobo', 'Booby', 'Bovid', 'Bug', 'Camel', 'Canid', 'Carp', 'Cat', 'list', 'Cattle', 'list', 'list', 'Clam', 'Cobra', 'Cod', 'Condor', 'Coral', 'Cougar', 'Cow', 'Coyote', 'Crab', 'Crane', 'Crow', 'Cuckoo', 'Cicada', 'Deer', 'Dingo', 'list', 'Dog', 'list', 'Donkey', 'list', 'Dove', 'Dragon', 'Duck', 'list', 'Eagle', 'Earwig', 'Eel', 'Egret', 'Elk', 'Emu', 'Ermine', 'Falcon', 'Ferret', 'Finch', 'Fish', 'Flea', 'Fly', 'Fowl', 'Fox', 'Frog', 'list', 'list', 'Gecko', 'Gerbil', 'Gibbon', 'Goat', 'list', 'Goose', 'list', 'Gopher', 'Grouse', 'Guan', 'list', 'list', 'list', 'Gull', 'Guppy', 'Hare', 'Hawk', 'Heron', 'Hornet', 'Horse', 'list', 'Hyena', 'Iguana', 'Impala', 'Jackal', 'Jaguar', 'Jay', 'Kite', 'Kiwi', 'Koala', 'Koi', 'Krill', 'Lark', 'Leech', 'Lemur', 'Leopon', 'Limpet', 'Lion', 'Lizard', 'Llama', 'Locust', 'Loon', 'Louse', 'Lynx', 'Macaw', 'Magpie', 'Mammal', 'Marlin', 'Marmot', 'Marten', 'Mink', 'Minnow', 'Mite', 'Mole', 'Monkey', 'Moose', 'Moth', 'Mouse', 'Mule', 'Muskox', 'Newt', 'Ocelot', 'Orca', 'Otter', 'Owl', 'Ox', 'Panda', 'Parrot', 'Perch', 'Pig', 'Pigeon', 'list', 'Pike', 'Pony', 'Possum', 'Prawn', 'Puffin', 'Puma', 'Python', 'Quail', 'Quelea', 'Quokka', 'Rabbit', 'list', 'Rat', 'Raven', 'Rodent', 'Rook', 'Salmon', 'Shark', 'list', 'Sheep', 'list', 'Shrew', 'Shrimp', 'Skink', 'Skunk', 'Sloth', 'Slug', 'Smelt', 'Snail', 'Snake', 'list', 'Snipe', 'Sole', 'Spider', 'Squid', 'Stoat', 'Stork', 'Swan', 'Swift', 'Tahr', 'Takin', 'Tapir', 'Tern', 'Thrush', 'Tick', 'Tiger', 'Tiglon', 'Toad', 'Toucan', 'Trout', 'Tuna', 'Turkey', 'list', 'Turtle', 'Urial', 'Vicuna', 'Viper', 'Vole', 'Walrus', 'Wasp', 'Weasel', 'Whale', 'Wolf', 'Wombat', 'Worm', 'Wren', 'Yak', 'Zebra', 'Alpaca', 'Cat', 'Cattle', 'Dog', 'Donkey', 'Ferret', 'Gayal', 'Guppy', 'Horse', 'Koi', 'Llama', 'Sheep', 'Yak']
verbs = ['abide', 'accept', 'acted', 'adapt', 'add', 'admire', 'admit', 'adopt', 'advise', 'afford', 'agree', 'alert', 'alight', 'allow', 'amuse', 'annoy', 'answer', 'appear', 'argue', 'arise', 'arrest', 'arrive', 'ask', 'assess', 'assist', 'assure', 'attach', 'attack', 'attain', 'attend', 'avoid', 'awake', 'back', 'bake', 'ban', 'bang', 'bare', 'bat', 'bathe', 'battle', 'be', 'beam', 'bear', 'beat', 'become', 'beg', 'begin', 'behave', 'behold', 'belong', 'bend', 'beset', 'bet', 'bid', 'bind', 'bite', 'bleach', 'bleed', 'bless', 'blind', 'blink', 'blot', 'blow', 'blush', 'boast', 'boil', 'bolt', 'bomb', 'book', 'bore', 'borrow', 'bounce', 'bow', 'box', 'brake', 'branch', 'break', 'breed', 'brief', 'bring', 'bruise', 'brush', 'bubble', 'budget', 'build', 'bump', 'burn', 'burst', 'bury', 'bust', 'buy', 'buze', 'call', 'camp', 'care', 'carry', 'carve', 'cast', 'catch', 'cause', 'change', 'charge', 'chart', 'chase', 'cheat', 'check', 'cheer', 'chew', 'choke', 'choose', 'chop', 'claim', 'clap', 'clean', 'clear', 'cling', 'clip', 'close', 'clothe', 'coach', 'coil', 'color', 'comb', 'come', 'copy', 'cost', 'cough', 'count', 'cover', 'crack', 'crash', 'crawl', 'create', 'creep', 'cross', 'crush', 'cry', 'cure', 'curl', 'curve', 'cut', 'cycle', 'dam', 'damage', 'dance', 'dare', 'deal', 'decay', 'decide', 'define', 'delay', 'depend', 'desert', 'design', 'detail', 'detect', 'devise', 'dig', 'direct', 'disarm', 'dive', 'divert', 'divide', 'do', 'double', 'doubt', 'draft', 'drag', 'drain', 'draw', 'dream', 'dress', 'drink', 'drip', 'drive', 'drop', 'drown', 'drum', 'dry', 'dust', 'dwell', 'earn', 'eat', 'edited', 'employ', 'empty', 'end', 'endure', 'enjoy', 'enlist', 'ensure', 'enter', 'escape', 'exceed', 'excite', 'excuse', 'exist', 'expand', 'expect', 'extend', 'face', 'fade', 'fail', 'fancy', 'fasten', 'fax', 'fear', 'feed', 'feel', 'fence', 'fetch', 'fight', 'file', 'fill', 'film', 'find', 'fire', 'fit', 'fix', 'flap', 'flash', 'flee', 'fling', 'float', 'flood', 'flow', 'flower', 'fly', 'fold', 'follow', 'fool', 'forbid', 'force', 'forego', 'forget', 'form', 'frame', 'freeze', 'fry', 'gather', 'gaze', 'get', 'give', 'glow', 'glue', 'go', 'govern', 'grab', 'grate', 'grease', 'greet', 'grin', 'grind', 'grip', 'groan', 'grow', 'guard', 'guess', 'guide', 'hammer', 'hand', 'handle', 'hang', 'happen', 'harass', 'harm', 'hate', 'haunt', 'head', 'heal', 'heap', 'hear', 'heat', 'help', 'hide', 'hit', 'hold', 'hook', 'hop', 'hope', 'hover', 'hug', 'hum', 'hunt', 'hurry', 'hurt', 'ignore', 'induce', 'inform', 'inject', 'injure', 'inlay', 'input', 'insure', 'intend', 'invent', 'invite', 'itch', 'jail', 'jam', 'jog', 'join', 'joke', 'judge', 'juggle', 'jump', 'keep', 'kept', 'kick', 'kill', 'kiss', 'kneel', 'knit', 'knock', 'knot', 'know', 'label', 'land', 'last', 'laugh', 'launch', 'lay', 'lead', 'lean', 'leap', 'learn', 'leave', 'led', 'lend', 'let', 'level', 'lick', 'lie', 'lifted', 'light', 'like', 'list', 'listen', 'live', 'load', 'locate', 'lock', 'log', 'long', 'look', 'lose', 'love', 'make', 'man', 'manage', 'map', 'march', 'mark', 'market', 'marry', 'match', 'mate', 'matter', 'mean', 'meddle', 'meet', 'melt', 'melt', 'mend', 'mentor', 'milk', 'mine', 'miss', 'mix', 'moan', 'model', 'modify', 'moor', 'mourn', 'move', 'mow', 'muddle', 'mug', 'murder', 'nail', 'name', 'need', 'nest', 'nod', 'note', 'notice', 'number', 'obey', 'object', 'obtain', 'occur', 'offend', 'offer', 'open', 'order', 'overdo', 'owe', 'own', 'pack', 'paddle', 'paint', 'park', 'part', 'pass', 'paste', 'pat', 'pause', 'pay', 'peck', 'pedal', 'peel', 'peep', 'permit', 'phone', 'pick', 'pilot', 'pinch', 'pine', 'place', 'plan', 'plant', 'play', 'plead', 'please', 'plug', 'point', 'poke', 'polish', 'pop', 'post', 'pour', 'pray', 'preach', 'prefer', 'preset', 'press', 'prick', 'print', 'prove', 'pull', 'pump', 'punch', 'punish', 'push', 'put', 'queue', 'quit', 'race', 'rain', 'raise', 'rank', 'rate', 'reach', 'read', 'reason', 'record', 'reduce', 'refer', 'refuse', 'regret', 'reign', 'reject', 'relate', 'relax', 'rely', 'remain', 'remind', 'remove', 'render', 'repair', 'repeat', 'reply', 'report', 'rescue', 'retire', 'return', 'review', 'revise', 'rhyme', 'rid', 'ride', 'ring', 'rinse', 'rise', 'risk', 'rob', 'rock', 'roll', 'rot', 'rub', 'ruin', 'rule', 'run', 'rush', 'sack', 'sail', 'save', 'saw', 'say', 'scare', 'scold', 'scorch', 'scrape', 'scream', 'screw', 'scrub', 'seal', 'search', 'secure', 'see', 'seek', 'select', 'sell', 'send', 'sense', 'serve', 'set', 'settle', 'sew', 'shade', 'shake', 'shape', 'share', 'shave', 'shear', 'shed', 'shine', 'shiver', 'shock', 'shoe', 'shoot', 'shop', 'show', 'shrink', 'shrug', 'shut', 'sigh', 'sign', 'signal', 'sin', 'sing', 'sink', 'sip', 'sit', 'sketch', 'ski', 'skip', 'slap', 'slay', 'sleep', 'slide', 'sling', 'slink', 'slip', 'slit', 'slow', 'smash', 'smell', 'smile', 'smite', 'smoke', 'snatch', 'sneak', 'sneeze', 'sniff', 'snore', 'snow', 'soak', 'solve', 'soothe', 'sort', 'sound', 'sow', 'spare', 'spark', 'speak', 'speed', 'spell', 'spend', 'spill', 'spin', 'spit', 'split', 'spoil', 'spot', 'spray', 'spread', 'spring', 'sprout', 'squash', 'squeak', 'squeal', 'stain', 'stamp', 'stand', 'stare', 'start', 'stay', 'steal', 'steer', 'step', 'stick', 'sting', 'stink', 'stir', 'stitch', 'stop', 'store', 'strap', 'stride', 'strike', 'string', 'strip', 'strive', 'stroke', 'study', 'stuff', 'sublet', 'suck', 'suffer', 'suit', 'supply', 'swear', 'sweat', 'sweep', 'swell', 'swim', 'swing', 'switch', 'take', 'talk', 'tame', 'tap', 'target', 'taste', 'teach', 'tear', 'tease', 'tell', 'tempt', 'test', 'thank', 'thaw', 'think', 'thrive', 'throw', 'thrust', 'tick', 'tickle', 'tie', 'time', 'tip', 'tire', 'touch', 'tour', 'tow', 'trace', 'trade', 'train', 'trap', 'travel', 'tread', 'treat', 'trick', 'trip', 'trot', 'trust', 'try', 'tug', 'tumble', 'turn', 'tutor', 'twist', 'type', 'unify', 'unite', 'unlock', 'unpack', 'untidy', 'update', 'uphold', 'upset', 'use', 'vanish', 'verify', 'vex', 'visit', 'wail', 'wait', 'wake', 'walk', 'wander', 'want', 'warm', 'warn', 'wash', 'waste', 'watch', 'water', 'wave', 'wear', 'weave', 'wed', 'weep', 'weigh', 'wend', 'wet', 'whine', 'whip', 'whirl', 'win', 'wind', 'wink', 'wipe', 'wish', 'wobble', 'wonder', 'work', 'worry', 'wrap', 'wreck', 'wring', 'write', 'x-ray', 'yawn', 'yell', 'zip', 'zoom']

def hello(event, context):
    s3 = boto3.resource('s3')

    sec = secrets.SystemRandom()
    key = generate_key(sec)
    while is_key_exists(s3, bucket, generate_route(key)):
        key = generate_key(sec)

    link = event['body']
    if "http" not in link:
        link = "http://" + link
        
    s3.Object(bucket, generate_route(key)).put(Body="", ACL='public-read', ContentType='text/html', WebsiteRedirectLocation=link)

    response = {
        "statusCode": 200,
        "headers": {
            "Access-Control-Allow-Origin" : "*",
            "Access-Control-Allow-Credentials" : True
        },
        "body": json.dumps({
            "url": key
        })
    }

    return response

def generate_route(key):
    return 'routes/' + key.lower() + '.html'

def generate_key(randomizer):
    adj = randomizer.choice(adjs).title()
    animal = randomizer.choice(animals).title()
    verb = randomizer.choice(verbs).title()
    key = adj + animal + verb
    key = key.replace(' ', '')

    return key

def is_key_exists(s3, bucket, route):
    try:
        s3.Object(bucket, route).load()
    except botocore.exceptions.ClientError as e:
        if e.response['Error']['Code'] == "403":
            return False
        else:
            return True
    else:
        return True
